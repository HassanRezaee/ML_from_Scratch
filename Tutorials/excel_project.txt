import openpyxl as xl
from openpyxl.chart import BarChart, Reference


def process_workbook(filename):
    wb = xl.load_workbook(filename)  # filename = 'transactions.xlsx'
    sheet = wb['Sheet1']
    cell = sheet['a1']  # equal to sheet.cell(1,1)

    for row in range(2,
                     sheet.max_row + 1):  # +1 because range does not include the upper limit, 2 to avoid the column heading
        cell = sheet.cell(row, 3)
        corrected_price = cell.value * 0.9  # the value for the new cell
        corrected_price_cell = sheet.cell(row, 4)  # a cell object in the spreadsheet
        corrected_price_cell.value = corrected_price

    values = Reference(sheet,
                       min_row=2,
                       max_row=sheet.max_row,
                       min_col=4,
                       max_col=4)

    chart = BarChart()
    chart.add_data(values)
    sheet.add_chart(chart, 'e2')

    wb.save('transactions2.xlsx')




import openpyxl as xl
from openpyxl.chart import Reference, BarChart

wb = xl.load_workbook('transactions2.xlsx')
sheet = wb['Sheet1']
sample_cell = sheet['a2']
print(sample_cell)

for row in range(2, sheet.max_row+1):
    cell = sheet.cell(row, 2)
    corrected_price = cell.value * 1000
    new_cell = sheet.cell(row,5)
    new_cell.value = corrected_price

values = Reference(sheet, min_col=5, max_col=5, min_row=2, max_row=sheet.max_row)
new_chart = BarChart()
new_chart.add_data(values)
sheet.add_chart(new_chart, 'e20')
wb.save('transaction3.xlsx')
